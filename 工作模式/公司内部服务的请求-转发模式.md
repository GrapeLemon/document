核心就是自己做了一次封装，提前准备好了service参数，这个就真的很秀了

```java
public interface SenderInterface {
    String getServiceName();
}
```

```java
public abstract class BaseSender extends JSONRPCRabbitSender implements SenderInterface {

    public <T> T send(String method, Object obj, TypeReference<T> type) throws JSONRPCError {
        JSONRPCResponse resp = this.send(getServiceName(), method, Tools.javaBeanToJsonObject(obj));
        return Tools.resolveJsonrpcResp(resp, type);
    }

    public <T> T send(String method, TypeReference<T> type) throws JSONRPCError {
        JSONRPCResponse resp = this.send(getServiceName(), method, new JSONObject());
        return Tools.resolveJsonrpcResp(resp, type);
    }

    public void send(String method, Object obj) throws JSONRPCError {
        JSONRPCResponse resp = this.send(getServiceName(), method, Tools.javaBeanToJsonObject(obj));
        Tools.resolveJsonrpcResp(resp);
    }

    public void send(String method) throws JSONRPCError {
        JSONRPCResponse resp = this.send(getServiceName(), method, new JSONObject());
        Tools.resolveJsonrpcResp(resp);
    }

}
```

```java
public class JSONRPCRabbitSender {
    private static final Logger LOG = LoggerFactory.getLogger(JSONRPCRabbitSender.class);
    @Inject
    private RabbitTemplate amqpTemplate;
    @Inject
    private JSONRPCTokenService tokenServ;

    public JSONRPCRabbitSender() {
    }

    public JSONRPCResponse send(String service, String method, JSONObject params) {
        JSONRPCRequest request = new JSONRPCRequest(method, params, RandomStrUtils.getRandomStr());
        return this.send(service, request);
    }

    public JSONRPCResponse send(String service, JSONRPCRequest request) {
        try {
            String response = this.sendRemote(service, request.toString());
            if (response == null) {
                return JSONRPCResponse.createError(request.getId(), 504, "time out");
            } else {
                JSONRPCResponse jsonrpcResp = JSONRPCResponse.parse(response);
                return jsonrpcResp;
            }
        } catch (Exception var5) {
            LOG.error(var5.getMessage(), var5);
            return null;
        }
    }

    private String sendRemote(String service, String request) {
        String corrId = RandomStrUtils.getRandomStr();
        MessageProperties properties = (MessageProperties)MessagePropertiesBuilder.newInstance().setCorrelationIdStringIfAbsent(corrId).setCorrelationIdIfAbsent(corrId.getBytes(Charsets.UTF_8)).build();
        Message amqpMsg = MessageBuilder.withBody(request.getBytes(Charsets.UTF_8)).andProperties(properties).build();
        Message result = this.amqpTemplate.sendAndReceive("gzbRpcBus", service, amqpMsg);
        return result == null ? null : new String(result.getBody(), Charsets.UTF_8);
    }
}
```

