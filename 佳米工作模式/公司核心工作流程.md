这里以 gzb_rpc-client为例来解释，在其他项目中的做法也是类似的

![1564559666761](D:\我的文档\佳米工作模式\images\一份jsonrpc请求响应文档.png)

当我们在别的文档上看到这样的一份请求的时候，我们应该按照什么样的流程工作呢？



# 1. 定义请求与响应的实体

```java
//请求实体
public class UsedCountQo {
    private String returnType;
  	private String countType;
    private List<String> categorys;
    private List<String> tenementIds;
    private Long startTime;
    private Long endTime;
}
```



```java
//返回实体(外层)
public class UsedCountVo {
    private String tenementId;
    private List<UsedCountItemVo> items;	//可以看到items里面还有别的数据，可以搞个类
}
```

```java
//返回实体(内层)
public class UsedCountItemVo {
    private HashSet<String> data;
    private String category;
    private int usedCount;
}
```



## 番外篇

```java
//通用的列表结果返回结构
public class GeneralItemsResult<T> {
    private long totalItems;
    private List<T> items;
}
```



# 2.定义接口

```java
public interface UsedCountService {
    GeneralItemsResult<UsedCountVo> search(UsedCountQo usedCountQo)  throws JSONRPCError;

    Future<UsedCountVo> search(UsedCountQo usedCountQo, Callback<UsedCountVo> callback)  throws JSONRPCError;
}
```





# 3.写实现

```java
public class UsedCountServiceImpl implements UsedCountService {

    private final String JSONRPC_USED_COUNT_SEARCH = "used.count.search";

    private BcClientService bcClientService;

    public UsedCountServiceImpl(BcClientService bcClientService) {
        this.bcClientService = bcClientService;
    }

    //先把这个方法吃透，这个是同步请求方法的模式
    @Override
    public GeneralItemsResult<UsedCountVo> search(UsedCountQo usedCountQo) throws JSONRPCError {
        GeneralItemsResult<UsedCountVo> result = this.bcClientService.getRabbitMqSender().send(JSONRPC_USED_COUNT_SEARCH, usedCountQo, new TypeReference<GeneralItemsResult<UsedCountVo>>() {
        });
        return result;
    }

    @Override
    public Future<UsedCountVo> search(UsedCountQo usedCountQo, Callback<UsedCountVo> callback) throws JSONRPCError {
        return null;
    }
}
```

## 番外篇

```java
public interface BcClientService {
    BcRabbitMqJsonRpcSender getRabbitMqSender();
    EventBus getBcEventBus();
    OplogService getOplogService();
    UsedCountService getUsedCountService();
    AdminService getAdminService();
    AdminMenuService getAdminMenuService();
}
```

```java
@Named
public class BcRabbitMqJsonRpcSender extends BaseSender {
    private String SERVICE_NAME = "gzbbc";

    @Override
    public String getServiceName() {	//原来实现写在子类这里，差点就错过了
        return SERVICE_NAME;
    }
}
```

基本上这就是整套流程了

